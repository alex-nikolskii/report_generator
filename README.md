# Генератор отчетов
Версия 2.0

Автор: Никольский Александр


## Требования
 - Python версии не ниже 3.6



## Состав
 - Парсер параметров (в командной строке): `entering_data`
 - Консольный генератор отчетов: `main`
 - Тесты: `tests`

Парсер шаблона отчета, если он в виде
 - таблицы: `table_pattern_reader`

Парсер исходных данных, если они в виде
 - таблицы: `table_data_reader`
 - текста: `data_reader`

Генераторы отчета 
 - в форме текста: `report_generator`
 - в форме таблицы: `table_report_generator`



## Описание
Приложение генерирует отчет по данным. Форма отчета задается персонально под нужды пользователя.

Пользователь с помощью определенного синтаксиса задает шаблон. Далее программа считывает данные пользователа, обрабатывает и генерирует отчет по ним.

Отчет можно выдать одним из двух способов:
 - текстом,
 - таблицей.



## Формат входных данных
Пользователь генератора должен обязательно указать два вида входных данных:
 - шаблон, в который будет проходить подстановка данных,
 - сами данные.
    Файлов с данными может быть несколько. У всех должна быть одинаковая кодировка.


##Данные

####Синтаксис
*Название_поля* = *значение*#
 - Имя и значение могут включать любые буквы, цифры, пробельные символы, "-" и ",".
 - Вокруг "=" могут быть пробельные символы.
 - Каждая строка данных заканчивается символом `#`.

####Примеры:
> Price =
> 201#

> read = books are alive
> with their own heart#

> Hoho = Я
> Есть
> Гр
> у
> у
> у
> у
> у
> у
> т#

>Number=100#
>screen check = 100#



## Шаблоны
Формат выходных данных задается с помощью шаблона. Синтаксис задания отчета текстом и таблицей различаются.

###Таблица
Чтобы генератор выдал отчет в виде таблицы, нужно задать следующие параметры:

- Указать перевод конца строк в входных файлах как LF разделитель(в UNIX по умолчанию).

 - table name - имя отчета (таблицы)
 - table columns - названия колонок
 - \*group - группировка (опционально)
 - \*filter - фильтрация (опционально)

####Синтаксис задания параметров:
 - table name: *Название_отчета*`#`
 - table columns: *Название_колонки*|*тип*-*длина_поля_при_печати*-*выравнивание*-*единицы_измерения*; (повторить столько раз, сколько будет колонок)`#`
 - group: fields|Тариф; Пол data|avg; Стоимость`#`
 - filter: *Название_колонки* = *Значение*`#`
    Задание параметров обязательно начинается с названия параметра и заканчивается знаком `#`. Между значениями параметров могут быть символы переноса строк и пробельные символы, но их не должно быть перед `#`.


####Пример:
> table name: Годовой отчет #
> table columns: ФИО|str-20-c-lala; тариф|str; Счет|int-20-c-рубли; Пол|str;
> Стоимость|int-20-c#
> group: fields|Тариф; Пол data|avg; Стоимость#
> filter: Тариф = Стандарт#

####Группировка

Группировка происходит только для колонок, которые есть в поле "table columns". Группировка происходит следующим образом: после ключевого слова "fields" указываются колонки(через ";"), которые будут в результирующей таблице. Все встречающиеся в файле данных наборы значений  будут указаны в таблице. Затем, после ключевого слова "data" указывается сначала функция агрегирования(группировки) -- либо sum, либо avg. После функции группировки через ";" указывается колонка, значения которой должны быть посчитаны. Функции группировки не будут работать к колонкам, значения которых не приводятся либо к типу int, либо к типу float.


####Фильтрация
Фильтрация происходит только для тех колонок, которые есть в таблице. После этой операции остаются значения, которые удовлетворили конкретным фильтрам. Если нужно отфильтровать значение, содержащее переносы строки, то в поле "filters" необходимо указать абсолютно идентичную строку. В противном случае не будет найдено поле.
Алгоритм фильтрации:
Если есть поле "group", то фильтрация происходит по результату, полученному после группировки.

Если поле "group" отсутствует, тогда фильтруется исходная таблица.
Если условий фильтрации не было, то возвращается вся таблица.


###Текст
Файл с шаблоном - это текст с дырами определенного формата. У каждой дыры есть параметры:
 - название
 - \*длина поля в символах (опционально)
 - \*выравнивание (опционально)
 - \*единицы измерения (опционально)


####Синтаксис:
{{*название_поля*|*длина_поля_в_символах*-*выравнивание*-*единицы_измерения*}}#
 - Задание параметров обязательно заканчивается знаком `#`.
 - Опциональные параметры идут строго в данной последовательности.
 - Нельзя пропускать опциональные поля, если вы хотите задать только один из последних параметров.
 - Если нужно задать опциональные параметры, после названия поля идет символ `|`.
 - Если опциональных параметров у поля нет, оно выглядит так: {{*name*}}.
 - Между параметрами могут стоят символы переноса строки и пробельные символы. Но их не должно быть сразу после открывающихся и прямо перед закрывающимися скобками (пример ниже).

####Экранирование:
Синтаксис: !!{{*поле*}}
Экранирование происходит, если в шаблоне перед {{}} поставить !!. Тогда поле будет распознаваться как обычный текст.


####Примеры:
> {{Price|40-c-рубль}}#

> {{Price|40-r}} {{read}} {{read}}#

> lalala {{Number|20-c}}#

> {{read}}    {{books|30-l}}    !!{{Price|20-c}}#

> {{fee|15-c-pears}}#

> {{Hoho|
> 20-
> c-
> honik}}#

> !Anything!

> Привет, я есть {{Hoho}}#

> !!{{screen check}}#
> // ничего не вставится - мы заэкранировали поле


**Работать не будет:**
> {{Name|str-12-c-unit
> }}#

> {{
> 	Name|str-12-c-unit
> }}#

> {{
> Name|str-12-c-unit}}#




## Справка по запуску
Подробную справку можно найти в приложении, если ввести такие начальные параметры:
`>> python3 main.py -h`

Пример использования программы:
`>> python3 main.py -p temp.txt -d data.txt -in text`

Задание кодировки:
`>> python3 main.py -p temp.txt -d data.txt -de utf-16 -pe utf-16 -in text`

Задание выходного формата отчета:
`>> python3 main.py -p temp.txt -d data.txt -in text `
`>> python3 main.py -p temp.txt -d data.txt -in table `

Изменение дефолтного значения длины поля отчета:
`>> python3 main.py -p temp.txt -d data.txt -in text -l 30`

Ввод нескольких файлов с данными:
`>> python3 main.py -p temp.txt -d data1.txt data2.txt data3.txt -in text`

Примеры для быстрой проверки работы программы:

Для вывода таблицы с одним файлом данных:

`>> python3 main.py -p pattern.txt -d table_data.txt -in table`

Для множественных таблиц:

`>> python3 main.py -p pattern.txt -d table_data.txt table_data2.txt -in table`

Для форматирования текста c одним входным файлом:

`>> python3 main.py -p pattern_reader.txt -d data_reader.txt -in text`

Аналогично для множественных входных файлов:
`>> python3 main.py -p pattern_reader.txt -d data_reader.txt data_reader2.txt -in text`

